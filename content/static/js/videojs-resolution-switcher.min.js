/*! videojs-resolution-switcher - 2015-7-26
 * Copyright (c) 2016 Kasper Moskwiak
 * Modified by Pierre Kraft
 * Licensed under the Apache-2.0 license. */
(function(){var a=null;if(typeof window.videojs==="undefined"&&typeof require==="function"){a=require("video.js")}else{a=window.videojs}(function(h,g){var f={},c,j={},b={};function e(o,n,m,p){j={label:m,sources:n};if(typeof p==="function"){return p(o,n,m)}return o.src(n.map(function(q){return{src:q.src,type:q.type,res:q.res}}))}var k=g.getComponent("MenuItem");var l=g.extend(k,{constructor:function(o,n,p,m){this.onClickListener=p;this.label=m;k.call(this,o,n);this.src=n.src;this.on("click",this.onClick);this.on("touchstart",this.onClick);if(n.initialySelected){this.showAsLabel();this.selected(true);this.addClass("vjs-selected")}},showAsLabel:function(){if(this.label){this.label.innerHTML=this.options_.label}},onClick:function(p){this.onClickListener(this);var o=this.player_.currentTime();var m=this.player_.paused();this.showAsLabel();this.addClass("vjs-selected");if(!m){this.player_.bigPlayButton.hide()}if(typeof p!=="function"&&typeof this.options_.customSourcePicker==="function"){p=this.options_.customSourcePicker}var n="loadeddata";if(this.player_.techName_!=="Youtube"&&this.player_.preload()==="none"&&this.player_.techName_!=="Flash"){n="timeupdate"}e(this.player_,this.src,this.options_.label,p);this.player_.one(n,function(){this.player_.currentTime(o);this.player_.handleTechSeeked_();if(!m){this.player_.play();this.player_.handleTechSeeked_()}this.player_.trigger("resolutionchange")})}});var i=g.getComponent("MenuButton");var d=g.extend(i,{constructor:function(p,n,q,m){this.sources=n.sources;this.label=m;this.label.innerHTML=n.initialySelectedLabel;i.call(this,p,n,q);this.controlText("Quality");if(q.dynamicLabel){this.el().appendChild(m)}else{var o=document.createElement("span");g.addClass(o,"vjs-resolution-button-staticlabel");this.el().appendChild(o)}},createItems:function(){var n=[];var p=(this.sources&&this.sources.label)||{};var o=function(q){n.map(function(r){r.selected(r===q);r.removeClass("vjs-selected")})};for(var m in p){if(p.hasOwnProperty(m)){n.push(new l(this.player_,{label:m,src:p[m],initialySelected:m===this.options_.initialySelectedLabel,customSourcePicker:this.options_.customSourcePicker},o,this.label));b[m]=n[n.length-1]}}return n}});c=function(w){var p=g.mergeOptions(f,w),u=this,t=document.createElement("span"),s={};g.addClass(t,"vjs-resolution-button-label");u.updateSrc=function(y){if(!y){return u.src()}if(u.topBar.resolutionSwitcher){u.topBar.resolutionSwitcher.dispose();delete u.topBar.resolutionSwitcher}y=y.sort(r);s=q(y);var z=o(s,y);var x=new d(u,{sources:s,initialySelectedLabel:z.label,initialySelectedRes:z.res,customSourcePicker:p.customSourcePicker},p,t);g.addClass(x.el(),"vjs-resolution-button");u.topBar.resolutionSwitcher=u.topBar.el_.appendChild(x.el_);u.topBar.resolutionSwitcher.dispose=function(){this.parentNode.removeChild(this)};return e(u,z.sources,z.label)};u.currentResolution=function(x,y){if(x==null){return j}if(b[x]!=null){b[x].onClick(y)}return u};u.getGroupedSrc=function(){return s};function r(y,x){if(!y.res||!x.res){return 0}return(+x.res)-(+y.res)}function q(y){var x={label:{},res:{},type:{}};y.map(function(z){m(x,"label",z);m(x,"res",z);m(x,"type",z);v(x,"label",z);v(x,"res",z);v(x,"type",z)});return x}function m(x,y,z){if(x[y][z[y]]==null){x[y][z[y]]=[]}}function v(x,y,z){x[y][z[y]].push(z)}function o(z,A){var y=p["default"];var x="";if(y==="high"){y=A[0].res;x=A[0].label}else{if(y==="low"||y==null||!z.res[y]){y=A[A.length-1].res;x=A[A.length-1].label}else{if(z.res[y]){x=z.res[y][0].label}}}return{res:y,label:x,sources:z.res[y]}}function n(x){x.tech_.ytPlayer.setPlaybackQuality("default");x.tech_.ytPlayer.addEventListener("onPlaybackQualityChange",function(){x.trigger("resolutionchange")});x.one("play",function(){var B=x.tech_.ytPlayer.getAvailableQualityLevels();var C={highres:{res:1080,label:"1080",yt:"highres"},hd1080:{res:1080,label:"1080",yt:"hd1080"},hd720:{res:720,label:"720",yt:"hd720"},large:{res:480,label:"480",yt:"large"},medium:{res:360,label:"360",yt:"medium"},small:{res:240,label:"240",yt:"small"},tiny:{res:144,label:"144",yt:"tiny"},auto:{res:0,label:"auto",yt:"default"}};var y=[];B.map(function(E){y.push({src:x.src().src,type:x.src().type,label:C[E].label,res:C[E].res,_yt:C[E].yt})});s=q(y);var A=function(F,E,G){x.tech_.ytPlayer.setPlaybackQuality(E[0]._yt);return x};var D={label:"auto",res:0,sources:s.label.auto};var z=new d(x,{sources:s,initialySelectedLabel:D.label,initialySelectedRes:D.res,customSourcePicker:A},p,t);z.el().classList.add("vjs-resolution-button");x.topBar.resolutionSwitcher=x.topBar.addChild(z)})}u.ready(function(){if(u.options_.sources.length>1){u.updateSrc(u.options_.sources)}if(u.techName_==="Youtube"){n(u)}})};g.plugin("videoJsResolutionSwitcher",c)})(window,a)})();