$(document).ready(function(){var a,A,t,z,k=true,e=true;var u=$("#player")[0];s();function s(){b();if(!MEETING_ID){return}var E="/meetings/"+MEETING_ID+"/playlist.m3u8";if(Hls.isSupported()){if(hls){hls.destroy();if(hls.bufferTimer){clearInterval(hls.bufferTimer);hls.bufferTimer=undefined}hls=null}if(!k){$("#HlsStatus").text("Streaming disabled");return}$("#HlsStatus").text("loading "+E);a={url:E,t0:performance.now(),load:[],buffer:[],video:[],level:[],bitrate:[]};C=v=null;z={audio:[],video:[]};hls=new Hls({debug:true,enableWorker:e});$("#HlsStatus").text("loading manifest and attaching video element...");hls.loadSource(E);hls.attachMedia(u);hls.on(Hls.Events.MEDIA_ATTACHED,function(){$("#HlsStatus").text("MediaSource attached...");l=-1;a.video.push({time:performance.now()-a.t0,type:"Media attached"})});hls.on(Hls.Events.MEDIA_DETACHED,function(){$("#HlsStatus").text("MediaSource detached...");l=-1;a.video.push({time:performance.now()-a.t0,type:"Media detached"})});hls.on(Hls.Events.FRAG_PARSING_INIT_SEGMENT,function(F,G){x();var F={time:performance.now()-a.t0,type:G.id+" init segment"};a.video.push(F)});hls.on(Hls.Events.FRAG_PARSING_METADATA,function(F,G){});hls.on(Hls.Events.LEVEL_SWITCHING,function(F,G){a.level.push({time:performance.now()-a.t0,id:G.level,bitrate:Math.round(hls.levels[G.level].bitrate/1000)});B()});hls.on(Hls.Events.MANIFEST_PARSED,function(F,G){var F={type:"manifest",name:"",start:0,end:G.levels.length,time:G.stats.trequest-a.t0,latency:G.stats.tfirst-G.stats.trequest,load:G.stats.tload-G.stats.tfirst,duration:G.stats.tload-G.stats.tfirst};a.load.push(F);refreshCanvas()});hls.on(Hls.Events.MANIFEST_PARSED,function(F,G){$("#HlsStatus").text("manifest successfully loaded,"+hls.levels.length+" levels found");A={levelNb:G.levels.length,levelParsed:0};B()});hls.on(Hls.Events.AUDIO_TRACKS_UPDATED,function(F,G){$("#HlsStatus").text(G.audioTracks.length+" audio tracks found");n()});hls.on(Hls.Events.AUDIO_TRACK_SWITCHING,function(F,G){n();var F={time:performance.now()-a.t0,type:"audio switching",name:"@"+G.id};a.video.push(F);j=a.video.length-1});hls.on(Hls.Events.AUDIO_TRACK_SWITCHED,function(F,G){n();var F={time:performance.now()-a.t0,type:"audio switched",name:"@"+G.id};if(j!==undefined){a.video[j].duration=F.time-a.video[j].time;j=undefined}a.video.push(F)});hls.on(Hls.Events.LEVEL_LOADED,function(G,H){a.isLive=H.details.live;var G={type:"level",id:H.level,start:H.details.startSN,end:H.details.endSN,time:H.stats.trequest-a.t0,latency:H.stats.tfirst-H.stats.trequest,load:H.stats.tload-H.stats.tfirst,parsing:H.stats.tparsed-H.stats.tload,duration:H.stats.tload-H.stats.tfirst};const F=H.stats.tparsed-H.stats.tload;if(A.levelParsed){this.sumLevelParsingMs+=F}else{this.sumLevelParsingMs=F}A.levelParsed++;A.levelParsingUs=Math.round(1000*this.sumLevelParsingMs/A.levelParsed);console.log("parsing level duration :"+A.levelParsingUs+"us,count:"+A.levelParsed);a.load.push(G);refreshCanvas()});hls.on(Hls.Events.AUDIO_TRACK_LOADED,function(F,G){a.isLive=G.details.live;var F={type:"audio track",id:G.id,start:G.details.startSN,end:G.details.endSN,time:G.stats.trequest-a.t0,latency:G.stats.tfirst-G.stats.trequest,load:G.stats.tload-G.stats.tfirst,parsing:G.stats.tparsed-G.stats.tload,duration:G.stats.tload-G.stats.tfirst};a.load.push(F);refreshCanvas()});hls.on(Hls.Events.FRAG_BUFFERED,function(H,J){var H={type:J.frag.type+" fragment",id:J.frag.level,id2:J.frag.sn,time:J.stats.trequest-a.t0,latency:J.stats.tfirst-J.stats.trequest,load:J.stats.tload-J.stats.tfirst,parsing:J.stats.tparsed-J.stats.tload,buffer:J.stats.tbuffered-J.stats.tparsed,duration:J.stats.tbuffered-J.stats.tfirst,bw:Math.round(8*J.stats.total/(J.stats.tbuffered-J.stats.trequest)),size:J.stats.total};a.load.push(H);a.bitrate.push({time:performance.now()-a.t0,bitrate:H.bw,duration:J.frag.duration,level:H.id});if(hls.bufferTimer===undefined){a.buffer.push({time:0,buffer:0,pos:0});hls.bufferTimer=window.setInterval(f,100)}refreshCanvas();B();var I=J.stats.tfirst-J.stats.trequest,F=J.stats.tparsed-J.stats.tload,K=J.stats.tbuffered-J.stats.trequest,G=Math.round(8*J.stats.length/(J.stats.tbuffered-J.stats.tfirst));if(A.fragBuffered){A.fragMinLatency=Math.min(A.fragMinLatency,I);A.fragMaxLatency=Math.max(A.fragMaxLatency,I);A.fragMinProcess=Math.min(A.fragMinProcess,K);A.fragMaxProcess=Math.max(A.fragMaxProcess,K);A.fragMinKbps=Math.min(A.fragMinKbps,G);A.fragMaxKbps=Math.max(A.fragMaxKbps,G);A.autoLevelCappingMin=Math.min(A.autoLevelCappingMin,hls.autoLevelCapping);A.autoLevelCappingMax=Math.max(A.autoLevelCappingMax,hls.autoLevelCapping);A.fragBuffered++}else{A.fragMinLatency=A.fragMaxLatency=I;A.fragMinProcess=A.fragMaxProcess=K;A.fragMinKbps=A.fragMaxKbps=G;A.fragBuffered=1;A.fragBufferedBytes=0;A.autoLevelCappingMin=A.autoLevelCappingMax=hls.autoLevelCapping;this.sumLatency=0;this.sumKbps=0;this.sumProcess=0;this.sumParsing=0}A.fraglastLatency=I;this.sumLatency+=I;A.fragAvgLatency=Math.round(this.sumLatency/A.fragBuffered);A.fragLastProcess=K;this.sumProcess+=K;this.sumParsing+=F;A.fragAvgProcess=Math.round(this.sumProcess/A.fragBuffered);A.fragLastKbps=G;this.sumKbps+=G;A.fragAvgKbps=Math.round(this.sumKbps/A.fragBuffered);A.fragBufferedBytes+=J.stats.total;A.fragparsingKbps=Math.round(8*A.fragBufferedBytes/this.sumParsing);A.fragparsingMs=Math.round(this.sumParsing);A.autoLevelCappingLast=hls.autoLevelCapping});hls.on(Hls.Events.LEVEL_SWITCHED,function(F,G){var F={time:performance.now()-a.t0,type:"level switched",name:G.level};a.video.push(F);refreshCanvas();B()});hls.on(Hls.Events.FRAG_CHANGED,function(G,H){var G={time:performance.now()-a.t0,type:"frag changed",name:H.frag.sn+" @ "+H.frag.level};a.video.push(G);refreshCanvas();B();A.tagList=H.frag.tagList;var I=H.frag.level,F=H.frag.autoLevel;if(A.levelStart===undefined){A.levelStart=I}if(F){if(A.fragChangedAuto){A.autoLevelMin=Math.min(A.autoLevelMin,I);A.autoLevelMax=Math.max(A.autoLevelMax,I);A.fragChangedAuto++;if(this.levelLastAuto&&I!==A.autoLevelLast){A.autoLevelSwitch++}}else{A.autoLevelMin=A.autoLevelMax=I;A.autoLevelSwitch=0;A.fragChangedAuto=1;this.sumAutoLevel=0}this.sumAutoLevel+=I;A.autoLevelAvg=Math.round(1000*this.sumAutoLevel/A.fragChangedAuto)/1000;A.autoLevelLast=I}else{if(A.fragChangedManual){A.manualLevelMin=Math.min(A.manualLevelMin,I);A.manualLevelMax=Math.max(A.manualLevelMax,I);A.fragChangedManual++;if(!this.levelLastAuto&&I!==A.manualLevelLast){A.manualLevelSwitch++}}else{A.manualLevelMin=A.manualLevelMax=I;A.manualLevelSwitch=0;A.fragChangedManual=1}A.manualLevelLast=I}this.levelLastAuto=F});hls.on(Hls.Events.FRAG_LOAD_EMERGENCY_ABORTED,function(F,G){if(A){if(A.fragLoadEmergencyAborted===undefined){A.fragLoadEmergencyAborted=1}else{A.fragLoadEmergencyAborted++}}});hls.on(Hls.Events.FRAG_DECRYPTED,function(F,G){if(!A.fragDecrypted){A.fragDecrypted=0;this.totalDecryptTime=0;A.fragAvgDecryptTime=0}A.fragDecrypted++;this.totalDecryptTime+=G.stats.tdecrypt-G.stats.tstart;A.fragAvgDecryptTime=this.totalDecryptTime/A.fragDecrypted});hls.on(Hls.Events.ERROR,function(G,H){console.warn(H);switch(H.details){case Hls.ErrorDetails.MANIFEST_LOAD_ERROR:try{$("#HlsStatus").html('cannot Load <a href="'+H.context.url+'">'+E+"</a><br>HTTP response code:"+H.response.code+" <br>"+H.response.text);if(H.response.code===0){$("#HlsStatus").append('this might be a CORS issue, consider installing <a href="https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi">Allow-Control-Allow-Origin</a> Chrome Extension')}}catch(F){$("#HlsStatus").html('cannot Load <a href="'+H.context.url+'">'+E+"</a><br>Reason:Load "+H.response.text)}break;case Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT:$("#HlsStatus").text("timeout while loading manifest");break;case Hls.ErrorDetails.MANIFEST_PARSING_ERROR:$("#HlsStatus").text("error while parsing manifest:"+H.reason);break;case Hls.ErrorDetails.LEVEL_LOAD_ERROR:$("#HlsStatus").text("error while loading level playlist");break;case Hls.ErrorDetails.LEVEL_LOAD_TIMEOUT:$("#HlsStatus").text("timeout while loading level playlist");break;case Hls.ErrorDetails.LEVEL_SWITCH_ERROR:$("#HlsStatus").text("error while trying to switch to level "+H.level);break;case Hls.ErrorDetails.FRAG_LOAD_ERROR:$("#HlsStatus").text("error while loading fragment "+H.frag.url);break;case Hls.ErrorDetails.FRAG_LOAD_TIMEOUT:$("#HlsStatus").text("timeout while loading fragment "+H.frag.url);break;case Hls.ErrorDetails.FRAG_LOOP_LOADING_ERROR:$("#HlsStatus").text("Frag Loop Loading Error");break;case Hls.ErrorDetails.FRAG_DECRYPT_ERROR:$("#HlsStatus").text("Decrypting Error:"+H.reason);break;case Hls.ErrorDetails.FRAG_PARSING_ERROR:$("#HlsStatus").text("Parsing Error:"+H.reason);break;case Hls.ErrorDetails.KEY_LOAD_ERROR:$("#HlsStatus").text("error while loading key "+H.frag.decryptdata.uri);break;case Hls.ErrorDetails.KEY_LOAD_TIMEOUT:$("#HlsStatus").text("timeout while loading key "+H.frag.decryptdata.uri);break;case Hls.ErrorDetails.BUFFER_APPEND_ERROR:$("#HlsStatus").text("Buffer Append Error");break;case Hls.ErrorDetails.BUFFER_ADD_CODEC_ERROR:$("#HlsStatus").text("Buffer Add Codec Error for "+H.mimeType+":"+H.err.message);break;case Hls.ErrorDetails.BUFFER_APPENDING_ERROR:$("#HlsStatus").text("Buffer Appending Error");break;default:break}if(H.fatal){console.log("fatal error :"+H.details);switch(H.type){case Hls.ErrorTypes.MEDIA_ERROR:D();break;case Hls.ErrorTypes.NETWORK_ERROR:$("#HlsStatus").append(",network error ...");break;default:$("#HlsStatus").append(", unrecoverable error");hls.destroy();break}console.log($("#HlsStatus").text())}if(!A){A={}}if(A[H.details]===undefined){A[H.details]=1}else{A[H.details]+=1}if(H.fatal){if(A.fatalError===undefined){A.fatalError=1}else{A.fatalError+=1}}$("#HlsStats").text(JSON.stringify(c(A),null,"\t"))});hls.on(Hls.Events.BUFFER_CREATED,function(F,G){t=G.tracks});hls.on(Hls.Events.BUFFER_APPENDING,function(F,G){});hls.on(Hls.Events.FPS_DROP,function(G,H){var F={time:performance.now()-a.t0,type:"frame drop",name:H.currentDropped+"/"+H.currentDecoded};a.video.push(F);if(A){if(A.fpsDropEvent===undefined){A.fpsDropEvent=1}else{A.fpsDropEvent++}A.fpsTotalDroppedFrames=H.totalDroppedFrames}});u.addEventListener("resize",o);u.addEventListener("seeking",o);u.addEventListener("seeked",o);u.addEventListener("pause",o);u.addEventListener("play",o);u.addEventListener("canplay",o);u.addEventListener("canplaythrough",o);u.addEventListener("ended",o);u.addEventListener("playing",o);u.addEventListener("error",o);u.addEventListener("loadedmetadata",o);u.addEventListener("loadeddata",o);u.addEventListener("durationchange",o)}else{if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1){$("#HlsStatus").text("you are using Firefox, it looks like MediaSource is not enabled,<br>please ensure the following keys are set appropriately in <b>about:config</b><br>media.mediasource.enabled=true<br>media.mediasource.mp4.enabled=true<br><b>media.mediasource.whitelist=false</b>")}else{b();$("#extra_controls").hide();if(u.canPlayType("application/vnd.apple.mpegURL")){u.src=E}$("#HlsStatus").text("your Browser does not support MediaSourceExtension / MP4 mediasource")}}}var d,g,p,j;function o(E){var H="";switch(E.type){case"durationchange":if(E.target.duration-p<=0.5){return}p=E.target.duration;H=Math.round(E.target.duration*1000);break;case"resize":H=E.target.videoWidth+"/"+E.target.videoHeight;break;case"loadedmetadata":case"loadeddata":case"canplay":case"canplaythrough":case"ended":case"seeking":case"seeked":case"play":case"playing":g=E.target.currentTime;case"pause":case"waiting":case"stalled":case"error":H=Math.round(E.target.currentTime*1000);if(E.type==="error"){var I,F=E.currentTarget.error;switch(F.code){case F.MEDIA_ERR_ABORTED:I="You aborted the video playback";break;case F.MEDIA_ERR_DECODE:I="The video playback was aborted due to a corruption problem or because the video used features your browser did not support";D();break;case F.MEDIA_ERR_NETWORK:I="A network error caused the video download to fail part-way";break;case F.MEDIA_ERR_SRC_NOT_SUPPORTED:I="The video could not be loaded, either because the server or network failed or because the format is not supported";break}$("#HlsStatus").text(I);console.error(I)}break;default:break}var G={time:performance.now()-a.t0,type:E.type,name:H};a.video.push(G);if(E.type==="seeking"){d=a.video.length-1}if(E.type==="seeked"){a.video[d].duration=G.time-a.video[d].time}}var C,v;function D(){var E=performance.now();if(!C||(E-C)>3000){C=performance.now();$("#HlsStatus").append(",try to recover media Error ...");hls.recoverMediaError()}else{if(!v||(E-v)>3000){v=performance.now();$("#HlsStatus").append(",try to swap Audio Codec and recover media Error ...");hls.swapAudioCodec();hls.recoverMediaError()}else{$("#HlsStatus").append(",cannot recover, last media error recovery failed ...")}}}function q(G){var F="";for(var E=0;E<G.length;E++){F+="["+G.start(E)+","+G.end(E)+"]"}return F}var l=-1;function f(){var O=$("#player")[0];var F=$("#buffered_c")[0];var W=F.getContext("2d");var V=O.buffered;var U;W.fillStyle="black";W.fillRect(0,0,F.width,F.height);W.fillStyle="gray";if(V){if(!F.width||F.width!==O.clientWidth){F.width=O.clientWidth}var J=O.currentTime,aa;for(var Z=0,aa=0;Z<V.length;Z++){var I=V.start(Z)/O.duration*F.width;var H=V.end(Z)/O.duration*F.width;W.fillRect(I,3,Math.max(2,H-I),10);if(J>=V.start(Z)&&J<V.end(Z)){aa=V.end(Z)-J}}if(aa<=0.1&&O.paused===false&&(J-g)>0.5){if(p-J<=0.5&&a.isLive===false){}else{if(l!==-1){U=performance.now()-a.t0-a.video[l].time;a.video[l].duration=U;a.video[l].name=U}else{a.video.push({type:"buffering",time:performance.now()-a.t0});l=a.video.length-1}}}if(aa>0.1&&l!=-1){U=performance.now()-a.t0-a.video[l].time;a.video[l].duration=U;a.video[l].name=U;l=-1}var X={time:performance.now()-a.t0,buffer:Math.round(aa*1000),pos:Math.round(J*1000)};var R=a.buffer,Y=R.length;if(Y>1){var Q=R[Y-2],P=R[Y-1];var M=(Q.buffer-P.buffer)/(Q.time-P.time);var L=(P.buffer-X.buffer)/(P.time-X.time);var T=(Q.pos-P.pos)/(Q.time-P.time);var S=(P.pos-X.pos)/(P.time-X.time);if((M===L||Math.abs(M/L-1)<=0.3)&&(T===S||Math.abs(T/S-1)<=0.3)){R.pop()}}a.buffer.push(X);refreshCanvas();var K="Duration:"+O.duration+"<br>Buffered:"+q(O.buffered)+"<br>Seekable:"+q(O.seekable)+"<br>Played:"+q(O.played)+"<br>";if(hls.media){for(var G in t){K+=G+" Buffered:"+q(t[G].buffer.buffered)+"<br>"}var E=O.getVideoPlaybackQuality;if(E&&typeof(E)===typeof(Function)){K+="Dropped Frames:"+O.getVideoPlaybackQuality().droppedVideoFrames+"<br>";K+="Corrupted Frames:"+O.getVideoPlaybackQuality().corruptedVideoFrames+"<br>"}else{if(O.webkitDroppedFrameCount){K+="Dropped Frames:"+O.webkitDroppedFrameCount+"<br>"}}}$("#buffered_log").html(K);$("#HlsStats").text(JSON.stringify(c(A),null,"\t"));W.fillStyle="blue";var N=O.currentTime/O.duration*F.width;W.fillRect(N,0,2,15)}}function c(I){if(typeof I!=="object"){return I}var E={};var H=[];for(var G in I){H.push(G)}H.sort();for(var F in H){E[H[F]]=c(I[H[F]])}return E}function x(){showMetrics();$("#buffered_log").show();$("#buffered_c").show()}function b(){hideMetrics();$("#buffered_log").hide();$("#buffered_c").hide()}function y(){var F=JSON.stringify(a);var E=jsonpack.pack(F);console.log("packing JSON from "+F.length+" to "+E.length+" bytes");return btoa(E)}function r(){m(y())}function m(H){var G=document.createElement("textarea");G.value=H;document.body.appendChild(G);G.select();try{var I=document.execCommand("copy");var F=I?"successful":"unsuccessful";console.log("Copying text command was "+F)}catch(E){console.log("Oops, unable to copy")}document.body.removeChild(G)}function w(){var E=document.URL;E=E.substr(0,E.lastIndexOf("/")+1)+"metrics.html";console.log(E);window.open(E,"_blank")}function h(G){var E=Math.floor(Math.floor(G%3600)/60);var F=Math.floor(G%60);return E+":"+(F<10?"0":"")+F}function B(){if(!hls.levels){return}var E='<button type="button" class="btn btn-sm ';var G='btn-primary" ';var O='btn-success" ';var L=E;if(hls.autoLevelEnabled){L+=G}else{L+=O}L+='onclick="hls.currentLevel=-1">auto</button>';var J=E;if(hls.autoLevelEnabled){J+=G}else{J+=O}J+='onclick="hls.loadLevel=-1">auto</button>';var I=E;if(hls.autoLevelCapping===-1){I+=G}else{I+=O}I+='onclick="levelCapping=hls.autoLevelCapping=-1;updateLevelInfo();">auto</button>';var H=E;if(hls.autoLevelEnabled){H+=G}else{H+=O}H+='onclick="hls.nextLevel=-1">auto</button>';for(var F=0;F<hls.levels.length;F++){L+=E;if(hls.currentLevel===F){L+=G}else{L+=O}var K=F,M=i(F);if(M){K+="("+i(F)+")"}L+='onclick="hls.currentLevel='+F+'">'+K+"</button>";J+=E;if(hls.loadLevel===F){J+=G}else{J+=O}J+='onclick="hls.loadLevel='+F+'">'+K+"</button>";I+=E;if(hls.autoLevelCapping===F){I+=G}else{I+=O}I+='onclick="levelCapping=hls.autoLevelCapping='+F+';updateLevelInfo();">'+K+"</button>";H+=E;if(hls.nextLevel===F){H+=G}else{H+=O}H+='onclick="hls.nextLevel='+F+'">'+K+"</button>"}var N=$("#player")[0];if(N.videoWidth){$("#currentResolution").html("video resolution:"+N.videoWidth+"x"+N.videoHeight)}if($("#currentLevelControl").html()!=L){$("#currentLevelControl").html(L)}if($("#loadLevelControl").html()!=J){$("#loadLevelControl").html(J)}if($("#levelCappingControl").html()!=I){$("#levelCappingControl").html(I)}if($("#nextLevelControl").html()!=H){$("#nextLevelControl").html(H)}}function n(){var K='<button type="button" class="btn btn-sm ';var G='btn-primary" ';var J='btn-success" ';var I="";var F=hls.audioTrack,E=hls.audioTracks.length;for(var H=0;H<E;H++){I+=K;if(F===H){I+=G}else{I+=J}I+='onclick="hls.audioTrack='+H+'">'+hls.audioTracks[H].name+"</button>"}$("#audioTrackControl").html(I)}function i(E){if(hls&&hls.levels.length-1>=E){var F=hls.levels[E];if(F.name){return F.name}else{if(F.height){return(F.height+"p / "+Math.round(F.bitrate/1024)+"kb")}else{if(F.bitrate){return(Math.round(F.bitrate/1024)+"kb")}else{return null}}}}}});function buffered_seek(c){var b=$("#buffered_c")[0];var a=$("#player")[0];var d=(c.clientX-b.offsetLeft)/b.width*a.duration;a.currentTime=d};